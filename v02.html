<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文言文虚实词背诵</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "SimSun", "KaiTi", "STKaiti", "STSong", serif;
            background-color: #F8F6F2;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(26, 71, 49, 0.15);
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-hidden {
            transform: translateX(100%);
        }
        .overlay {
            transition: opacity 0.3s ease-in-out;
        }
        /* 3D翻转卡片样式 */
        .flip-card {
            perspective: 1000px;
            cursor: pointer;
            position: relative;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 0.5rem;
            box-sizing: border-box;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }
        .flip-card-front {
            cursor: pointer;
        }
        .flip-card-front:hover {
            box-shadow: 0 20px 25px -5px rgba(26, 71, 49, 0.1), 0 10px 10px -5px rgba(26, 71, 49, 0.04);
            transition: box-shadow 0.2s ease;
        }
        .flip-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #1A4731;
            font-size: 14px;
            opacity: 0.7;
            pointer-events: none;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 顶部搜索框 -->
    <header class="bg-[#1A4731] text-white py-6 px-4 shadow-lg">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl md:text-3xl font-bold">文言文虚实词背诵</h1>
                <button id="enterMemorizeBtn" class="bg-white text-[#1A4731] px-6 py-2 rounded-lg font-bold hover:bg-gray-100 transition-colors shadow-md">
                    实战推断
                </button>
            </div> 
            <div class="relative" id="searchContainer">
                <input 
                    type="text" 
                    id="searchInput"
                    placeholder="搜索词条（仅匹配词语本身，如：之、其、以），回车或空格分词" 
                    class="w-full px-6 py-4 text-lg rounded-lg bg-white text-[#1A4731] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 shadow-md"
                >
                <svg class="absolute right-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
            <div class="mt-4 flex items-center gap-3">
                <div class="text-white text-sm">数据集：</div>
                <button id="datasetXuBtn" class="px-3 py-1 bg-[#1A4731] text-white rounded">虚词</button>
                <button id="datasetShiBtn" class="px-3 py-1 bg-white text-[#1A4731] rounded">实词</button>
            </div> 
        </div>
    </header>

    <!-- 词语卡片区域 -->
    <main id="mainView" class="max-w-6xl mx-auto px-4 py-8">
        <div id="wordCards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            <!-- 卡片将通过 JavaScript 动态生成 -->
        </div>
        <div id="noResults" class="hidden text-center py-12 text-gray-500 text-lg">
            未找到相关词语
        </div>
    </main>

    <!-- 模式选择界面 -->
    <div id="modeSelectView" class="hidden min-h-screen flex flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-2xl">
            <div class="bg-white rounded-lg shadow-xl p-8 md:p-12 border-4 border-[#1A4731]">
                <h2 class="text-3xl font-bold text-[#1A4731] mb-8 text-center">选择练习模式</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <button id="mode1Btn" class="mode-btn bg-[#F8F6F2] border-4 border-[#1A4731] rounded-lg p-6 hover:bg-[#1A4731] hover:text-white transition-all">
                        <h3 class="text-2xl font-bold mb-3">模式一：挖空填词</h3>
                        <p class="text-gray-700 hover:text-white">例句中隐藏目标词，选择正确的词填入空白处（支持实词与虚词）</p>
                    </button>
                    <button id="mode2Btn" class="mode-btn bg-[#F8F6F2] border-4 border-[#1A4731] rounded-lg p-6 hover:bg-[#1A4731] hover:text-white transition-all">
                        <h3 class="text-2xl font-bold mb-3">模式二：词性推断</h3>
                        <p class="text-gray-700 hover:text-white">显示完整句子，选择目标词的词性和意思（支持实词与虚词）</p>
                    </button>
                </div>
                <button id="backToMainBtn" class="mt-6 w-full text-[#1A4731] hover:text-[#1A4731]/80 font-bold flex items-center justify-center">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    返回主页
                </button>
            </div>
        </div>
    </div>

    <!-- 实战推断模式视图 -->
    <div id="memorizeView" class="hidden min-h-screen flex flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-3xl flex flex-col">
            <!-- 进度条和返回按钮 -->
            <div class="w-full mb-6 flex-shrink-0">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center gap-4">
                        <button id="exitMemorizeBtn" class="text-[#1A4731] hover:text-[#1A4731]/80 font-bold flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            返回
                        </button>
                        <button id="switchModeBtn" class="text-[#1A4731] hover:text-[#1A4731]/80 font-bold text-sm border border-[#1A4731] px-3 py-1 rounded">
                            切换模式
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <span id="currentModeLabel" class="text-sm text-gray-600"></span>
                        <span id="progressText" class="text-[#1A4731] font-bold text-lg">1/10</span>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-[#1A4731] h-2 rounded-full transition-all duration-300" style="width: 10%"></div>
                </div>
            </div>

            <!-- 例句显示区域 -->
            <div class="w-full mb-6 flex-shrink-0">
                <div class="bg-white rounded-lg shadow-xl p-6 md:p-8 border-4 border-[#1A4731]">
                    <p class="text-xl md:text-2xl text-gray-800 leading-relaxed text-center" id="exampleSentence">
                        <!-- 例句将通过 JavaScript 动态生成 -->
                    </p>
                </div>
            </div>

            <!-- 选项区域 -->
            <div class="w-full mb-6 flex-shrink-0">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="optionsContainer">
                    <!-- 选项将通过 JavaScript 动态生成 -->
                </div>
            </div>

            <!-- 解析区域（选对后显示） -->
            <div id="explanationArea" class="w-full mb-6 flex-shrink-0 hidden">
                <div class="bg-[#F8F6F2] rounded-lg shadow-lg p-6 border-l-4 border-[#1A4731]">
                    <h3 class="text-lg font-bold text-[#1A4731] mb-4">完整解析</h3>
                    <div id="explanationContent" class="text-gray-800">
                        <!-- 解析内容将通过 JavaScript 动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 下一题按钮 -->
            <div class="w-full flex-shrink-0">
                <button id="nextBtn" class="w-full bg-[#1A4731] text-white py-4 rounded-lg font-bold text-lg hover:bg-[#1A4731]/90 transition-colors shadow-md hidden">
                    下一题
                </button>
            </div>
        </div>
    </div>

    <!-- 侧边栏详情弹窗 -->
    <div id="overlay" class="overlay fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="sidebar" class="sidebar sidebar-hidden fixed top-0 right-0 h-full w-full md:w-96 bg-white z-50 shadow-2xl overflow-y-auto">
        <div class="sticky top-0 bg-[#1A4731] text-white p-4 flex justify-between items-center">
            <h2 id="detailTitle" class="text-xl font-bold"></h2>
            <button id="closeSidebar" class="text-white hover:text-gray-200 text-2xl font-bold">&times;</button>
        </div>
        <div id="detailContent" class="p-6 text-gray-800">
            <!-- 详情内容将通过 JavaScript 动态生成 -->
        </div>
    </div>

    <!-- 登录/注册功能已移除 -->

    <script>
        /* 内置实词库（120 条常用实词）
   每项格式：{ word: "词", meanings: [ { usage: "词性", meaning: "释义", example: "示例句" } ] }
*/
window.shiData = [
  { word: "人", meanings: [
    { usage: "名词", meaning: "人；人类", example: "人者，万物之灵也。" },
    { usage: "代词", meaning: "某人；人们", example: "人有悲欢离合，月有阴晴圆缺。" }
  ] },
  { word: "君", meanings: [
    { usage: "名词", meaning: "君主；统治者", example: "君臣有义，国乃太平。" },
    { usage: "称谓", meaning: "对人的尊称（相当于‘你’）", example: "子与君行之。" }
  ] },
  { word: "臣", meanings: [
    { usage: "名词", meaning: "臣子；官员", example: "忠臣尽其职。" }
  ] },
  { word: "子", meanings: [
    { usage: "名词", meaning: "子孙；孩童", example: "父望子成龙。" },
    { usage: "称谓", meaning: "对晚辈或朋友的称呼（你）", example: "子之不学也。" }
  ] },
  { word: "父", meanings: [
    { usage: "名词", meaning: "父亲；长辈", example: "父为家之主。" }
  ] },
  { word: "母", meanings: [
    { usage: "名词", meaning: "母亲；长辈", example: "母慈子孝，和乐之家。" }
  ] },
  { word: "夫", meanings: [
    { usage: "名词", meaning: "丈夫；男子", example: "夫君有德，家道足矣。" }
  ] },
  { word: "妻", meanings: [
    { usage: "名词", meaning: "妻子；配偶", example: "妻贤夫祸少，家道中和。" }
  ] },
  { word: "王", meanings: [
    { usage: "名词", meaning: "王；君主", example: "王者以民为本。" }
  ] },
  { word: "国", meanings: [
    { usage: "名词", meaning: "国家；国土", example: "保国安民为臣之责。" }
  ] },
  { word: "民", meanings: [
    { usage: "名词", meaning: "人民；百姓", example: "民为国本，政在养民。" }
  ] },
  { word: "家", meanings: [
    { usage: "名词", meaning: "家；家庭；宗族", example: "修身齐家治国平天下。" }
  ] },
  { word: "宫", meanings: [
    { usage: "名词", meaning: "宫殿；朝廷", example: "宫闱深沉，政事纷纭。" }
  ] },
  { word: "天", meanings: [
    { usage: "名词", meaning: "天；上天；自然", example: "天行有常，不为尧存，不为桀亡。" }
  ] },
  { word: "地", meanings: [
    { usage: "名词", meaning: "大地；领域", example: "安土重迁，爱护土地。" }
  ] },
  { word: "山", meanings: [
    { usage: "名词", meaning: "山岭；高地", example: "登高望远，会当凌绝顶。" },
    { usage: "动词", meaning: "阻隔；成为障碍（古义）", example: "险山阻道。" }
  ] },
  { word: "水", meanings: [
    { usage: "名词", meaning: "水；江河；湖海", example: "江山如画，水光潋滟。" },
    { usage: "动词", meaning: "浸润；用水洗", example: "以水濯之。" }
  ] },
  { word: "日", meanings: [
    { usage: "名词", meaning: "太阳；日子", example: "日出而作，日落而息。" }
  ] },
  { word: "月", meanings: [
    { usage: "名词", meaning: "月亮；月份", example: "明月照我还。" }
  ] },
  { word: "星", meanings: [
    { usage: "名词", meaning: "星辰；天体", example: "星辰灿烂，夜色阑珊。" }
  ] },
  { word: "风", meanings: [
    { usage: "名词", meaning: "风；气象", example: "风起云涌。" }
  ] },
  { word: "云", meanings: [
    { usage: "名词", meaning: "云；云彩", example: "云卷云舒，四季循环。" }
  ] },
  { word: "火", meanings: [
    { usage: "名词", meaning: "火；光热", example: "火势迅猛，须防为上。" }
  ] },
  { word: "木", meanings: [
    { usage: "名词", meaning: "树木；木材", example: "林木参天。" }
  ] },
  { word: "石", meanings: [
    { usage: "名词", meaning: "石头；岩石", example: "石坚不可摧。" }
  ] },
  { word: "土", meanings: [
    { usage: "名词", meaning: "土壤；土地", example: "耕者有其田。" }
  ] },
  { word: "田", meanings: [
    { usage: "名词", meaning: "田地；耕地", example: "耕田植禾。" }
  ] },
  { word: "草", meanings: [
    { usage: "名词", meaning: "草木；植物", example: "野草青青。" }
  ] },
  { word: "花", meanings: [
    { usage: "名词", meaning: "花朵；开花", example: "花开富贵。" }
  ] },
  { word: "叶", meanings: [
    { usage: "名词", meaning: "叶子", example: "叶落归根。" }
  ] },
  { word: "狗", meanings: [
    { usage: "名词", meaning: "犬；犬类", example: "犬吠深巷。" }
  ] },
  { word: "马", meanings: [
    { usage: "名词", meaning: "马；良畜", example: "马到成功。" }
  ] },
  { word: "牛", meanings: [
    { usage: "名词", meaning: "牛；耕畜", example: "耕牛勤勤。" }
  ] },
  { word: "羊", meanings: [
    { usage: "名词", meaning: "羊；畜牧", example: "群羊在牧。" }
  ] },
  { word: "鸟", meanings: [
    { usage: "名词", meaning: "鸟类；飞禽", example: "百鸟齐鸣。" }
  ] },
  { word: "鱼", meanings: [
    { usage: "名词", meaning: "鱼类；水产", example: "江中之鱼。" }
  ] },
  { word: "兵", meanings: [
    { usage: "名词", meaning: "兵士；军队", example: "兵临城下。" }
  ] },
  { word: "战", meanings: [
    { usage: "动词", meaning: "作战；战争", example: "临战方显勇。" }
  ] },
  { word: "师", meanings: [
    { usage: "名词", meaning: "军队；老师", example: "师出有名。" }
  ] },
  { word: "将", meanings: [
    { usage: "名词", meaning: "将领；带领者", example: "将军统兵。" }
  ] },
  { word: "军", meanings: [
    { usage: "名词", meaning: "军队；武装力", example: "军容整肃。" }
  ] },
  { word: "行", meanings: [
    { usage: "动词", meaning: "行走；进行", example: "大道之行，天下为公。" }
  ] },
  { word: "来", meanings: [
    { usage: "动词", meaning: "来到；到来", example: "客从远方来。" }
  ] },
  { word: "去", meanings: [
    { usage: "动词", meaning: "离开；前往", example: "去者不可追。" }
  ] },
  { word: "见", meanings: [
    { usage: "动词", meaning: "看见；会见", example: "见贤思齐。" }
  ] },
  { word: "闻", meanings: [
    { usage: "动词", meaning: "听闻；得知", example: "闻名于世。" }
  ] },
  { word: "言", meanings: [
    { usage: "动词", meaning: "说话；表达", example: "言必信，行必果。" }
  ] },
  { word: "语", meanings: [
    { usage: "名词", meaning: "话语；言语", example: "语重心长。" }
  ] },
  { word: "书", meanings: [
    { usage: "名词", meaning: "书籍；文书", example: "读书明理。" }
  ] },
  { word: "学", meanings: [
    { usage: "动词", meaning: "学习；研习", example: "学而时习之。" }
  ] },
  { word: "教", meanings: [
    { usage: "动词", meaning: "教导；指导", example: "师者教之以礼。" }
  ] },
  { word: "道", meanings: [
    { usage: "名词", meaning: "方法；道理", example: "道可道，非常道。" }
  ] },
  { word: "德", meanings: [
    { usage: "名词", meaning: "品德；道德", example: "修身齐家治国平天下。" }
  ] },
  { word: "仁", meanings: [
    { usage: "名词", meaning: "仁爱；慈悲", example: "仁者爱人。" }
  ] },
  { word: "义", meanings: [
    { usage: "名词", meaning: "正义；义务", example: "义不容辞。" }
  ] },
  { word: "忠", meanings: [
    { usage: "名词", meaning: "忠诚；忠心", example: "忠臣报国。" }
  ] },
  { word: "孝", meanings: [
    { usage: "名词", meaning: "孝顺；孝敬", example: "孝悌为先。" }
  ] },
  { word: "智", meanings: [
    { usage: "名词", meaning: "智慧；聪明", example: "智者见机。" }
  ] },
  { word: "信", meanings: [
    { usage: "名词", meaning: "诚信；信用", example: "信义为重。" }
  ] },
  { word: "心", meanings: [
    { usage: "名词", meaning: "心；内心", example: "用心良苦。" }
  ] },
  { word: "思", meanings: [
    { usage: "动词", meaning: "思考；思念", example: "思接千载。" }
  ] },
  { word: "情", meanings: [
    { usage: "名词", meaning: "情感；情绪", example: "喜怒哀乐皆常情。" }
  ] },
  { word: "力", meanings: [
    { usage: "名词", meaning: "力量；能力", example: "力能扛鼎。" }
  ] },
  { word: "手", meanings: [
    { usage: "名词", meaning: "手；手段", example: "巧手匠心。" }
  ] },
  { word: "足", meanings: [
    { usage: "名词", meaning: "脚；足够", example: "足以为例。" }
  ] },
  { word: "目", meanings: [
    { usage: "名词", meaning: "眼目；观看", example: "目不暇接。" }
  ] },
  { word: "耳", meanings: [
    { usage: "名词", meaning: "耳朵；听觉", example: "闻者足戒。" }
  ] },
  { word: "舌", meanings: [
    { usage: "名词", meaning: "舌头；言语", example: "口舌之争。" }
  ] },
  { word: "口", meanings: [
    { usage: "名词", meaning: "口；入口", example: "口说无凭。" }
  ] },
  { word: "食", meanings: [
    { usage: "名词", meaning: "吃食；粮食", example: "民以食为天。" }
  ] },
  { word: "饮", meanings: [
    { usage: "动词", meaning: "喝饮；饮食", example: "饮水思源。" }
  ] },
  { word: "衣", meanings: [
    { usage: "名词", meaning: "衣服；穿着", example: "衣食足而后知荣辱。" }
  ] },
  { word: "帽", meanings: [
    { usage: "名词", meaning: "帽子；头饰", example: "冠帽端正。" }
  ] },
  { word: "居", meanings: [
    { usage: "动词", meaning: "居住；停留", example: "居安思危。" }
  ] },
  { word: "守", meanings: [
    { usage: "动词", meaning: "守护；防守", example: "家国需有人守。" }
  ] },
  { word: "走", meanings: [
    { usage: "动词", meaning: "奔走；行走", example: "走马观花。" }
  ] },
  { word: "坐", meanings: [
    { usage: "动词", meaning: "坐下；停留", example: "安坐待事。" }
  ] },
  { word: "立", meanings: [
    { usage: "动词", meaning: "站立；建立", example: "立身以立学为先。" }
  ] },
  { word: "起", meanings: [
    { usage: "动词", meaning: "起身；发生", example: "起而行之。" }
  ] },
  { word: "回", meanings: [
    { usage: "动词", meaning: "回转；返回", example: "回头是岸。" }
  ] },
  { word: "送", meanings: [
    { usage: "动词", meaning: "送达；赠送", example: "君子送客。" }
  ] },
  { word: "取", meanings: [
    { usage: "动词", meaning: "取得；拿取", example: "取长补短。" }
  ] },
  { word: "给", meanings: [
    { usage: "动词", meaning: "给予；供给", example: "以民为本，给以所需。" }
  ] },
  { word: "买", meanings: [
    { usage: "动词", meaning: "购买；交易", example: "市井间买卖。" }
  ] },
  { word: "卖", meanings: [
    { usage: "动词", meaning: "出售；贩卖", example: "货卖四方。" }
  ] },
  { word: "看", meanings: [
    { usage: "动词", meaning: "观看；看护", example: "看花听雨。" }
  ] },
  { word: "问", meanings: [
    { usage: "动词", meaning: "询问；请教", example: "问道于盲。" }
  ] },
  { word: "答", meanings: [
    { usage: "动词", meaning: "回答；回应", example: "答非所问。" }
  ] },
  { word: "求", meanings: [
    { usage: "动词", meaning: "请求；追求", example: "求之不得。" }
  ] },
  { word: "赐", meanings: [
    { usage: "动词", meaning: "赏赐；给予", example: "赐金以报功。" }
  ] },
  { word: "赏", meanings: [
    { usage: "动词", meaning: "赏赐；嘉奖", example: "赏罚分明。" }
  ] },
  { word: "惩", meanings: [
    { usage: "动词", meaning: "惩罚；制裁", example: "以惩不良。" }
  ] },
  { word: "罚", meanings: [
    { usage: "动词", meaning: "处罚；惩罚", example: "依法惩罚。" }
  ] },
  { word: "法", meanings: [
    { usage: "名词", meaning: "法律；规章", example: "法治为本。" }
  ] },
  { word: "礼", meanings: [
    { usage: "名词", meaning: "礼仪；礼节", example: "礼仪之邦。" }
  ] },
  { word: "制", meanings: [
    { usage: "名词", meaning: "制度；法度", example: "制度严明。" }
  ] },
  { word: "成", meanings: [
    { usage: "动词", meaning: "成就；完成", example: "成事在人。" }
  ] },
  { word: "败", meanings: [
    { usage: "动词", meaning: "失败；战败", example: "胜败乃兵家常事。" }
  ] },
  { word: "富", meanings: [
    { usage: "形容词", meaning: "富有；富裕", example: "富贵不能淫。" }
  ] },
  { word: "贫", meanings: [
    { usage: "形容词", meaning: "贫穷；贫困", example: "贫而无怨。" }
  ] },
  { word: "平", meanings: [
    { usage: "形容词", meaning: "平坦；平和", example: "天下太平。" }
  ] },
  { word: "和", meanings: [
    { usage: "连词/名词", meaning: "和睦；和平", example: "和而不同。" }
  ] },
  { word: "胜", meanings: [
    { usage: "动词", meaning: "胜利；克服", example: "以德胜人。" }
  ] },
  { word: "图", meanings: [
    { usage: "动词", meaning: "谋划；图谋", example: "图谋大业。" }
  ] },
  { word: "朝", meanings: [
    { usage: "名词", meaning: "朝廷；早晨", example: "朝堂之上。" }
  ] },
  { word: "夕", meanings: [
    { usage: "名词", meaning: "傍晚；夜晚", example: "夕阳西下。" }
  ] },
  { word: "年", meanings: [
    { usage: "名词", meaning: "年；岁月", example: "岁月如梭，年年复始。" }
  ] },
  { word: "时", meanings: [
    { usage: "名词", meaning: "时光；时候", example: "时不我待。" }
  ] },
  { word: "期", meanings: [
    { usage: "名词", meaning: "时期；期限", example: "期许未来。" }
  ] },
  { word: "前", meanings: [
    { usage: "方位/时间", meaning: "前面；之前", example: "前事不忘。" }
  ] },
  { word: "后", meanings: [
    { usage: "方位/时间", meaning: "后面；以后", example: "后会有期。" }
  ] },
  { word: "上", meanings: [
    { usage: "方位", meaning: "上方；上面", example: "上善若水。" }
  ] },
  { word: "下", meanings: [
    { usage: "方位", meaning: "下方；下面", example: "下不为例。" }
  ] },
  { word: "内", meanings: [
    { usage: "方位", meaning: "内部；里面", example: "内外兼修。" }
  ] },
  { word: "外", meanings: [
    { usage: "方位", meaning: "外部；外面", example: "外强中干。" }
  ] },
  { word: "左", meanings: [
    { usage: "方位", meaning: "左侧；左边", example: "左顾右盼。" }
  ] },
  { word: "右", meanings: [
    { usage: "方位", meaning: "右侧；右边", example: "右文左武。" }
  ] },
  { word: "东", meanings: [
    { usage: "方位", meaning: "东方；东边", example: "东山再起。" }
  ] },
  { word: "西", meanings: [
    { usage: "方位", meaning: "西方；西边", example: "西山日落。" }
  ] },
  { word: "中", meanings: [
    { usage: "方位/名词", meaning: "中间；中心", example: "中庸之道。" }
  ] }
];

    </script>

    <script>
        // 词库数据
        const wordData = [
            {
                word: "之",
                meanings: [
                    { usage: "代词", meaning: "他、她、它（们）", example: "学而时习之，不亦说乎？" },
                    { usage: "助词", meaning: "的", example: "古之学者必有师。" },
                    { usage: "助词", meaning: "取消句子独立性", example: "师道之不传也久矣！" },
                    { usage: "动词", meaning: "到、往", example: "吾欲之南海，何如？" },
                    { usage: "助词", meaning: "宾语前置标志", example: "何陋之有？" }
                ]
            },
            {
                word: "其",
                meanings: [
                    { usage: "代词", meaning: "他（她、它）的；他（她、它）们的", example: "其志洁，其行廉。" },
                    { usage: "代词", meaning: "其中的", example: "其一犬坐于前。" },
                    { usage: "副词", meaning: "大概、或许", example: "其皆出于此乎？" },
                    { usage: "连词", meaning: "如果、假如", example: "其若是，孰能御之？" },
                    { usage: "语气词", meaning: "表反问或推测", example: "其真无马邪？其真不知马也！" }
                ]
            },
            {
                word: "以",
                meanings: [
                    { usage: "介词", meaning: "用、拿、凭借", example: "以子之矛，陷子之盾，何如？" },
                    { usage: "介词", meaning: "因为、由于", example: "不以物喜，不以己悲。" },
                    { usage: "连词", meaning: "来、用来", example: "属予作文以记之。" },
                    { usage: "连词", meaning: "而、而且", example: "夫夷以近，则游者众。" },
                    { usage: "动词", meaning: "认为", example: "皆以美于徐公。" }
                ]
            },
            {
                word: "而",
                meanings: [
                    { usage: "连词", meaning: "表并列", example: "永州之野产异蛇，黑质而白章。" },
                    { usage: "连词", meaning: "表转折", example: "青，取之于蓝，而青于蓝。" },
                    { usage: "连词", meaning: "表顺承", example: "余闻而愈悲。" },
                    { usage: "连词", meaning: "表修饰", example: "吾尝跂而望矣，不如登高之博见也。" },
                    { usage: "代词", meaning: "你、你的", example: "而翁归，自与汝复算耳！" }
                ]
            },
            {
                word: "于",
                meanings: [
                    { usage: "介词", meaning: "在、到", example: "战于长勺。" },
                    { usage: "介词", meaning: "向、对", example: "告之于帝。" },
                    { usage: "介词", meaning: "比", example: "冰，水为之，而寒于水。" },
                    { usage: "介词", meaning: "从、自", example: "青，取之于蓝。" },
                    { usage: "介词", meaning: "被", example: "吾不能举全吴之地，十万之众，受制于人。" }
                ]
            },
            {
                word: "则",
                meanings: [
                    { usage: "连词", meaning: "就、那么", example: "学而不思则罔，思而不学则殆。" },
                    { usage: "连词", meaning: "如果、假如", example: "入则无法家拂士，出则无敌国外患者，国恒亡。" },
                    { usage: "连词", meaning: "却、可是", example: "至则无可用，放之山下。" },
                    { usage: "名词", meaning: "法则、准则", example: "此则岳阳楼之大观也。" }
                ]
            },
            {
                word: "乃",
                meanings: [
                    { usage: "副词", meaning: "于是、就", example: "乃入见。" },
                    { usage: "副词", meaning: "才", example: "今乃弃黔首以资敌国。" },
                    { usage: "副词", meaning: "竟然、却", example: "问今是何世，乃不知有汉。" },
                    { usage: "代词", meaning: "你、你的", example: "家祭无忘告乃翁。" },
                    { usage: "判断词", meaning: "是、就是", example: "当立者乃公子扶苏。" }
                ]
            },
            {
                word: "者",
                meanings: [
                    { usage: "助词", meaning: "的人、的事、的东西", example: "得道者多助，失道者寡助。" },
                    { usage: "助词", meaning: "表停顿", example: "北山愚公者，年且九十。" },
                    { usage: "助词", meaning: "定语后置标志", example: "求人可使报秦者，未得。" },
                    { usage: "代词", meaning: "这、这样", example: "者回，者次，者般。" }
                ]
            },
            {
                word: "乎",
                meanings: [
                    { usage: "语气词", meaning: "吗、呢（表疑问）", example: "学而时习之，不亦说乎？" },
                    { usage: "语气词", meaning: "吧（表推测）", example: "其皆出于此乎？" },
                    { usage: "语气词", meaning: "啊（表感叹）", example: "危乎高哉！" },
                    { usage: "介词", meaning: "于、在", example: "生乎吾前，其闻道也固先乎吾。" }
                ]
            },
            {
                word: "焉",
                meanings: [
                    { usage: "代词", meaning: "它、他、哪里", example: "且焉置土石？" },
                    { usage: "语气词", meaning: "了、啊", example: "寒暑易节，始一反焉。" },
                    { usage: "兼词", meaning: "于之、于此", example: "积土成山，风雨兴焉。" },
                    { usage: "疑问代词", meaning: "哪里、怎么", example: "焉有仁人在位，罔民而可为也？" }
                ]
            }
        ];

        // 当前激活数据（默认为虚词）
        let activeData = wordData;

        // 渲染卡片
        function renderCards(words) {
            const container = document.getElementById('wordCards');
            const noResults = document.getElementById('noResults');
            
            if (words.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            container.innerHTML = words.map(word => `
                <div class="card-hover bg-white rounded-lg shadow-md p-6 cursor-pointer border-l-4 border-[#1A4731]" 
                     onclick="showDetail('${word.word}')">
                    <h3 class="text-2xl font-bold text-[#1A4731] mb-2">${word.word}</h3>
                    <p class="text-gray-600 text-sm">${word.meanings.length} 种用法</p>
                </div>
            `).join('');
        }

        // 数据集切换与导入
        function switchDataset(type) {
            const xuBtn = document.getElementById('datasetXuBtn');
            const shiBtn = document.getElementById('datasetShiBtn');
            const base = 'px-3 py-1 rounded';
            const selected = 'bg-white text-[#1A4731]';
            const unselected = 'bg-[#1A4731] text-white';

            if (type === 'shi') {
                // 使用内置 shiData（在 shi.js）
                if (typeof window.shiData === 'undefined') window.shiData = [];
                activeData = window.shiData;
                // 明确设置 className，避免类冲突
                xuBtn.className = `${base} ${unselected}`;
                shiBtn.className = `${base} ${selected}`;
            } else {
                activeData = wordData;
                xuBtn.className = `${base} ${selected}`;
                shiBtn.className = `${base} ${unselected}`;
            }

            renderCards(activeData);
        }



        // 显示详情
        function showDetail(word) {
            // 优先从当前激活数据查找（支持虚词与实词），并做容错
            const wordInfo = (activeData || []).find(w => w.word === word);
            if (!wordInfo) return;

            const title = document.getElementById('detailTitle');
            const content = document.getElementById('detailContent');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            title.textContent = wordInfo.word;
            content.innerHTML = wordInfo.meanings.map((m, index) => `
                <div class="mb-6 pb-6 border-b border-gray-200 last:border-b-0">
                    <div class="flex items-center mb-3">
                        <span class="bg-[#1A4731] text-white px-3 py-1 rounded text-sm font-bold">${m.usage}</span>
                        <span class="ml-3 text-lg font-semibold text-gray-800">${m.meaning}</span>
                    </div>
                    <div class="bg-[#F8F6F2] p-4 rounded-lg border-l-4 border-[#1A4731]">
                        <p class="text-gray-700 italic">${m.example}</p>
                    </div>
                </div>
            `).join('');

            sidebar.classList.remove('sidebar-hidden');
            overlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 关闭侧边栏
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.add('sidebar-hidden');
            overlay.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // 搜索功能（改进：仅在词条本身匹配，按空格分词，所有关键字需匹配）
        function handleSearch() {
            const raw = document.getElementById('searchInput').value.trim();
            const searchTerm = raw.toLowerCase();
            // 按空格分词，短词或单词将被单独匹配；空输入返回全部
            const tokens = searchTerm.split(/\s+/).filter(Boolean);
            const norm = s => (s || '').toLowerCase();

            if (tokens.length === 0) {
                renderCards(activeData);
                return;
            }

            const filtered = (activeData || []).filter(word => {
                // 仅在词条本身（word.word）匹配，每个 token 均需匹配（AND）
                return tokens.every(tok => norm(word.word).includes(tok));
            });

            renderCards(filtered);
        }

        // 实战推断模式相关变量
        let practiceMode = false;
        let currentMode = 1; // 1: 挖空填词, 2: 词性推断
        let currentQuestion = null;
        let questionCount = 0;
        let correctCount = 0;
        let answered = false;

        // 进入实战推断模式（显示模式选择）
        function enterMemorizeMode() {
            document.getElementById('mainView').classList.add('hidden');
            document.getElementById('modeSelectView').classList.remove('hidden');
            document.getElementById('searchContainer').classList.add('hidden');
            document.getElementById('enterMemorizeBtn').classList.add('hidden');
        }

        // 选择模式并开始练习
        function startPracticeMode(mode) {
            currentMode = mode;
            practiceMode = true;
            questionCount = 0;
            correctCount = 0;
            answered = false;
            
            document.getElementById('modeSelectView').classList.add('hidden');
            document.getElementById('memorizeView').classList.remove('hidden');
            
            updateModeLabel();
            generateQuestion();
        }

        // 切换模式
        function switchMode() {
            if (confirm('确定要切换模式吗？当前进度将重置。')) {
                startPracticeMode(currentMode === 1 ? 2 : 1);
            }
        }

        // 更新模式标签
        function updateModeLabel() {
            const label = document.getElementById('currentModeLabel');
            label.textContent = currentMode === 1 ? '模式一：挖空填词' : '模式二：词性推断';
        }

        // 退出实战推断模式
        function exitMemorizeMode() {
            practiceMode = false;
            document.getElementById('mainView').classList.remove('hidden');
            document.getElementById('memorizeView').classList.add('hidden');
            document.getElementById('modeSelectView').classList.add('hidden');
            document.getElementById('searchContainer').classList.remove('hidden');
            document.getElementById('enterMemorizeBtn').classList.remove('hidden');
        }

        // 返回主页
        function backToMain() {
            document.getElementById('mainView').classList.remove('hidden');
            document.getElementById('modeSelectView').classList.add('hidden');
            document.getElementById('searchContainer').classList.remove('hidden');
            document.getElementById('enterMemorizeBtn').classList.remove('hidden');
        }

        // 生成题目
        function generateQuestion() {
            answered = false;
            
            // 确保当前激活数据存在
            if (!activeData || activeData.length === 0) {
                alert('当前数据集为空，无法生成题目');
                return;
            }

            // 随机选择一个词语
            const randomWord = activeData[Math.floor(Math.random() * activeData.length)];
            
            // 随机选择该词语的一个用法
            const randomMeaning = randomWord.meanings[Math.floor(Math.random() * randomWord.meanings.length)];
            
            // 获取例句
            const example = randomMeaning.example;
            const keyword = randomWord.word;
            
            // 隐藏关键词，用下划线替代
            const hiddenExample = example.replace(new RegExp(keyword, 'g'), '_____');
            
            // 生成选项（1个正确答案 + 3个干扰项）
            const options = generateOptions(randomWord, randomMeaning);
            
            // 保存当前题目信息
            const correctIndex = options.findIndex(opt => opt.isCorrect);
            currentQuestion = {
                word: randomWord.word,
                correctMeaning: randomMeaning,
                example: example,
                hiddenExample: hiddenExample,
                options: options,
                correctIndex: correctIndex
            };
            
            // 显示题目
            displayQuestion();
        }

        // 生成选项
        function generateOptions(correctWord, correctMeaning) {
            if (currentMode === 1) {
                // 模式1：挖空填虚词 - 选项是虚词名称
                const options = [correctWord.word];
                
                // 收集所有其他虚词作为干扰项
                const pool = (activeData || wordData);
                const otherWords = pool
                    .filter(w => w.word !== correctWord.word)
                    .map(w => w.word);
                
                // 随机选择3个干扰项
                const shuffled = otherWords.sort(() => 0.5 - Math.random());
                for (let i = 0; i < 3 && i < shuffled.length; i++) {
                    options.push(shuffled[i]);
                }
                
                // 打乱选项顺序
                return options.sort(() => 0.5 - Math.random()).map(word => ({
                    word: word,
                    isCorrect: word === correctWord.word
                }));
            } else {
                // 模式2：词性推断 - 选项是词性和意思的组合
                const options = [{
                    word: correctWord.word,
                    usage: correctMeaning.usage,
                    meaning: correctMeaning.meaning,
                    displayText: `${correctMeaning.usage}：${correctMeaning.meaning}`
                }];
                
                // 收集所有其他用法作为干扰项
                const allMeanings = [];
                (activeData || wordData).forEach(word => {
                    word.meanings.forEach(meaning => {
                        if (word.word !== correctWord.word || meaning.usage !== correctMeaning.usage || meaning.meaning !== correctMeaning.meaning) {
                            allMeanings.push({
                                word: word.word,
                                usage: meaning.usage,
                                meaning: meaning.meaning,
                                displayText: `${meaning.usage}：${meaning.meaning}`
                            });
                        }
                    });
                });
                
                // 随机选择3个干扰项
                const shuffled = allMeanings.sort(() => 0.5 - Math.random());
                for (let i = 0; i < 3 && i < shuffled.length; i++) {
                    options.push(shuffled[i]);
                }
                
                // 打乱选项顺序
                return options.sort(() => 0.5 - Math.random()).map(opt => ({
                    ...opt,
                    isCorrect: opt.word === correctWord.word && opt.usage === correctMeaning.usage && opt.meaning === correctMeaning.meaning
                }));
            }
        }

        // 显示题目
        function displayQuestion() {
            // 显示例句（模式1显示挖空的，模式2显示完整的）
            const sentenceText = currentMode === 1 ? currentQuestion.hiddenExample : currentQuestion.example;
            document.getElementById('exampleSentence').innerHTML = sentenceText;
            
            // 显示选项
            const optionsContainer = document.getElementById('optionsContainer');
            if (currentMode === 1) {
                // 模式1：显示虚词名称
                optionsContainer.innerHTML = currentQuestion.options.map((option, index) => {
                    const optionLabel = String.fromCharCode(65 + index); // A, B, C, D
                    return `
                        <button 
                            class="option-btn bg-white border-2 border-[#1A4731] rounded-lg p-6 text-center hover:bg-[#F8F6F2] hover:shadow-md transition-all cursor-pointer active:scale-95"
                            data-index="${index}"
                        >
                            <span class="bg-[#1A4731] text-white w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold mr-3 inline-flex">${optionLabel}</span>
                            <span class="text-4xl font-bold text-[#1A4731]">${option.word}</span>
                        </button>
                    `;
                }).join('');
            } else {
                // 模式2：显示词性和意思
                optionsContainer.innerHTML = currentQuestion.options.map((option, index) => {
                    const optionLabel = String.fromCharCode(65 + index); // A, B, C, D
                    return `
                        <button 
                            class="option-btn bg-white border-2 border-[#1A4731] rounded-lg p-4 text-left hover:bg-[#F8F6F2] hover:shadow-md transition-all cursor-pointer active:scale-95"
                            data-index="${index}"
                        >
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1A4731] text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">${optionLabel}</span>
                                <span class="text-sm font-semibold text-gray-600">${option.usage}</span>
                            </div>
                            <p class="text-gray-800 ml-11">${option.meaning}</p>
                        </button>
                    `;
                }).join('');
            }
            
            // 使用事件委托绑定点击事件
            optionsContainer.querySelectorAll('.option-btn').forEach((btn, index) => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    selectOption(parseInt(this.getAttribute('data-index')));
                });
            });
            
            // 隐藏解析和下一题按钮
            document.getElementById('explanationArea').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            
            // 更新进度
            updateProgress();
        }

        // 选择选项
        function selectOption(selectedIndex) {
            if (!practiceMode || !currentQuestion || answered) {
                return;
            }
            
            answered = true;
            const isCorrect = selectedIndex === currentQuestion.correctIndex;
            
            // 更新选项按钮样式
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons.forEach((btn, index) => {
                btn.disabled = true;
                btn.style.pointerEvents = 'none';
                if (index === currentQuestion.correctIndex) {
                    btn.classList.remove('border-[#1A4731]', 'hover:bg-[#F8F6F2]');
                    btn.classList.add('border-green-500', 'bg-green-50');
                } else if (index === selectedIndex && !isCorrect) {
                    btn.classList.remove('border-[#1A4731]', 'hover:bg-[#F8F6F2]');
                    btn.classList.add('border-red-500', 'bg-red-50');
                } else {
                    btn.classList.add('opacity-50');
                }
            });
            
            questionCount++;
            if (isCorrect) {
                correctCount++;
                // 选对后显示完整解析
                showExplanation();
            } else {
                // 选错后只显示正确答案，不显示完整解析
                showCorrectAnswerOnly();
            }
        }

        // 只显示正确答案（选错时）
        function showCorrectAnswerOnly() {
            const explanationContent = document.getElementById('explanationContent');
            
            explanationContent.innerHTML = `
                <div class="mb-4">
                    <p class="text-lg mb-2"><strong>完整例句：</strong></p>
                    <p class="text-xl text-[#1A4731] font-semibold mb-4">${currentQuestion.example}</p>
                </div>
                <div>
                    <p class="text-lg mb-2"><strong>正确答案：</strong></p>
                    <div class="flex items-center mb-2">
                        <span class="text-2xl font-bold text-[#1A4731] mr-3">${currentQuestion.word}</span>
                        <span class="bg-[#1A4731] text-white px-3 py-1 rounded text-sm font-bold">${currentQuestion.correctMeaning.usage}</span>
                        <span class="ml-3 text-lg font-semibold text-gray-800">${currentQuestion.correctMeaning.meaning}</span>
                    </div>
                </div>
                <p class="text-gray-600 mt-4 italic">答错了！选对后才能查看完整解析。</p>
            `;
            
            document.getElementById('explanationArea').classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        // 显示解析
        function showExplanation() {
            const wordInfo = activeData.find(w => w.word === currentQuestion.word);
            const explanationContent = document.getElementById('explanationContent');
            
            explanationContent.innerHTML = `
                <div class="mb-4">
                    <p class="text-lg mb-2"><strong>完整例句：</strong></p>
                    <p class="text-xl text-[#1A4731] font-semibold mb-4">${currentQuestion.example}</p>
                </div>
                <div class="mb-4">
                    <p class="text-lg mb-2"><strong>正确答案：</strong></p>
                    <div class="flex items-center mb-2">
                        <span class="text-2xl font-bold text-[#1A4731] mr-3">${currentQuestion.word}</span>
                        <span class="bg-[#1A4731] text-white px-3 py-1 rounded text-sm font-bold">${currentQuestion.correctMeaning.usage}</span>
                        <span class="ml-3 text-lg font-semibold text-gray-800">${currentQuestion.correctMeaning.meaning}</span>
                    </div>
                </div>
                <div>
                    <p class="text-lg mb-2"><strong>该词的其他用法：</strong></p>
                    ${wordInfo.meanings.map(m => `
                        <div class="mb-3 pb-3 border-b border-gray-200 last:border-b-0">
                            <div class="flex items-center mb-1">
                                <span class="bg-gray-600 text-white px-2 py-1 rounded text-xs font-bold">${m.usage}</span>
                                <span class="ml-2 text-sm text-gray-700">${m.meaning}</span>
                            </div>
                            <p class="text-sm text-gray-600 italic ml-1">${m.example}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('explanationArea').classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        // 下一题
        function nextQuestion() {
            generateQuestion();
        }

        // 更新进度
        function updateProgress() {
            const total = (activeData || wordData).length * 2; // 假设总共做一定数量的题目
            const percentage = questionCount > 0 ? (questionCount / total) * 100 : 0;
            
            document.getElementById('progressText').textContent = `第 ${questionCount} 题 (正确率: ${questionCount > 0 ? Math.round(correctCount / questionCount * 100) : 0}%)`;
            document.getElementById('progressBar').style.width = `${Math.min(percentage, 100)}%`;
        }

        // 事件监听
        document.getElementById('searchInput').addEventListener('input', handleSearch);
        document.getElementById('closeSidebar').addEventListener('click', closeSidebar);
        document.getElementById('overlay').addEventListener('click', closeSidebar);
        document.getElementById('datasetXuBtn').addEventListener('click', () => switchDataset('xu'));
        document.getElementById('datasetShiBtn').addEventListener('click', () => switchDataset('shi'));
        // 注：导入功能已移除，实词数据为内置资源（shi.js）
        
        // 实战推断模式事件监听
        document.getElementById('enterMemorizeBtn').addEventListener('click', enterMemorizeMode);
        document.getElementById('exitMemorizeBtn').addEventListener('click', exitMemorizeMode);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('switchModeBtn').addEventListener('click', switchMode);
        
        // 模式选择事件监听
        document.getElementById('mode1Btn').addEventListener('click', () => startPracticeMode(1));
        document.getElementById('mode2Btn').addEventListener('click', () => startPracticeMode(2));
        document.getElementById('backToMainBtn').addEventListener('click', backToMain);

        // 初始化渲染：两个按钮均为绿底（未选中），点击后选中变白
        const base = 'px-3 py-1 rounded';
        const unselected = 'bg-[#1A4731] text-white';
        document.getElementById('datasetXuBtn').className = `${base} ${unselected}`;
        document.getElementById('datasetShiBtn').className = `${base} ${unselected}`;
        renderCards(activeData);
    </script>
    
</body>

</html>

